<%= stylesheet_link_tag "search-yui-reset-min", "search-style", "search-master", "search-custom_jqueryui" %>

<script type="text/javascript">
  $(document).ready(function() {
    $('#ride_to_location_id').change(function() {
      if($(this).val() != ""){
        if ($(this).val() == $('#ride_from_location_id').val()) {
          $(".city-option-same").show();
          $('#ride_to_location_id').addClass("validation-error");
          $('#ride_from_location_id').addClass("validation-error");
          $("#btn-search").attr("disabled", "disabled");
        } else {
          $(".city-option-same").hide();
          $('#ride_to_location_id').removeClass("validation-error");
          $('#ride_from_location_id').removeClass("validation-error");
          $("#btn-search").removeAttr("disabled");
        }
      }
    });
    $('#ride_from_location_id').change(function() {
      if($(this).val() != ""){
        if ($(this).val() == $('#ride_to_location_id').val()) {
          $(".city-option-same").show();
          $('#ride_to_location_id').addClass("validation-error");
          $('#ride_from_location_id').addClass("validation-error");
          $("#btn-search").attr("disabled", "disabled");
        } else {
          $(".city-option-same").hide();
          $('#ride_to_location_id').removeClass("validation-error");
          $('#ride_from_location_id').removeClass("validation-error");
          $("#btn-search").removeAttr("disabled");
        }
      }
    });

    $( "#ride_departure" ).datepicker({
      dateFormat: "yy-mm-dd"
    });
  });
</script>
<div class="clear"></div>
<% if current_user %>

  <div class="subnav">
    <ul class="nav-pills nav">
      <li>
        <%= link_to "My Ride", rides_path %>
      </li>
      <li class="active">
        <%= link_to "Ride input page", new_ride_path %>
      </li>
      <li>
        <%= link_to "Ride search page", search_rides_path %>
      </li>
      <li>
        <%= link_to "My Dashboard", dashboard_path %>
      </li>
    </ul>
  </div>
<% end %>
<div id="search_run">
  <div id="header_wrap"  style="margin-top: 22px;">
    <div id="header">
      <ul id="top_nav">
        <li>
          <a id="post_ride" class="button post km_click_event_by_text" href="<%= new_ride_path %>">Post a ride</a>
        </li>
      </ul>
    </div>
  </div>

  <div id="content_wrapper" class="new_style">
    <div id="content_container" class="clearfix">
      <div id="content">
        <div id="head">
          <%= form_for :ride, :url => search_rides_path, :method => "get" do |f| %>
            <div class="search">
              <div class="text_input">
                <%= f.select :from_location_id, Location.all.collect {|p| [ p.name, p.id ] }, :include_blank => "----select city -----"%>
              </div>
              <div class="text_input">
                <%= f.select :to_location_id, Location.all.collect {|p| [ p.name, p.id ] }, :include_blank => "----select city -----" %>
              </div>
              <div class="text_input datetime">
                <label class="datetime_icon" for="search_date"></label>
                <%= f.text_field :departure %>
              </div>
              <%= f.submit "search", :class => "button confirm clickaway_confirm", :id => "btn-search"%>
            </div>
          <% end %>
          <div class="city-option-same" style="display: none"> From and To City can't be the same </div>
        </div>
        <div id="results">
          <div class="ride_list">
            <h3 class="headline first">
              Search Results
            </h3>
            <% if @rides.empty? %>
              <div class="entry">
                No Records Found
              </div>
            <%end%>
            <%@rides.each do |ride| %>
              <div class="entry">
                <div class="userpic">
                  <div class="username"><%= ride.owner.first_name%>&nbsp; <%= ride.owner.last_name.chars.first %></div>
                  <%= image_tag ride.owner.user_image.url.to_s %>
                  <span class="driver"></span>
                </div>
                <div class="price_box">
                  <div class="seats">
                    <%  if ride.remaining_seats==0 %>
                      <span class="count1">SOLD OUT</span>

                    <%else%>
                      <span class="count"><%= ride.remaining_seats %></span>
                      <span class="left">seats left</span>
                    <%end%>
                  </div>
                  <p><b><%= number_to_currency(ride.per_price_seat)%></b> / seat</p>
                </div>
                <div class="inner_content">
                  <div class="info-rides">
                    <div class="inner-info-line1"><p class="inner-l1">Leave: &nbsp; &nbsp;&nbsp;<span class="info-line1"><%= ride.departure_time.strftime("%I:%M %p")%></span> &nbsp; &nbsp;<%= ride.flexibility_in_minutes %> mins &nbsp; &nbsp<span class="info-line11"><%= ride.from_location && ride.from_location.name %></span></p></div>
                    <div class="inner-info-line1"><p class="inner-l1">Arrival: &nbsp;  &nbsp; <span class="info-line1"><%= (ride.departure_time + ride.duration_in_minutes.minutes).strftime("%I:%M %p")  %></span> &nbsp; &nbsp;<%= ride.flexibility_in_minutes %> mins &nbsp; &nbsp<span class="info-line11"><%= ride.to_location && ride.to_location.name %></span></p></div>
                  </div>
                  <div class="ride-image"><%= image_tag ("van.jpg") %><%= ride.ride_type %></div>
                  <div class="participant-pic"><%ride.ride_participants.active_participants.role_wise.each do |rider| %>
                      <div class="riders-pics">
                        <div class="riders-info"><%= rider.user.first_name%>&nbsp; <%= rider.user.last_name.chars.first %></div>
                        <%= image_tag rider.owner.user_image.url.to_s %>
                        <span class="driver"></span>
                      </div><%end%></div>
                </div>
              </div>
            <%end%>
            <div id="action">
              <div class="item postride">
                <h2>Didn't find what you were looking for?</h2>
                <p>Post a ride as a driver or passenger and get notified when new matches are found!</p>
                <a class="button post" href="<%= new_ride_path %>">Post a ride</a>
              </div>
            </div>
          </div>
          <div class="page_list">
            <%= will_paginate @rides %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



